<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Dragon Flight</title>
	<style type="text/css">
			body{
				font-family: Verdana, Arial, Sans;
				font-size: 16px; /* forces base font to be what I want, not what the user wants */
			}

			.dragon{
				position: absolute;
				top: 100px;
				left: 100px;
				width: 200px; 
				height: 144px;
				/*background-color: limegreen;*/
				background-image: url('images/dragon2.png');
				background-position:  0px 0px; 
			}

			.stage{
				position: absolute;
				top: 30px;
				left: 10px;
				right: 10px;
				bottom: 10px;
				background-color: #59744B;
				border: 1px solid black;
				background-image: url('images/fullbackground.jpg');
				background-position: 0px 0px;
				background-repeat: repeat-x;
				overflow: hidden;
			}

			.flame{
				width: 49px;
				height: 24px;
				background-image: url('images/flame2.png');
				background-position: -49px 0px;
				position: absolute;
				top: 300px;
				left: 300px;
			}

			.enemy{
				width: 72px;
				height: 44px;
				position: absolute;
				background-image: url('images/purplebird.png');
			}

			.enemy.blue{
				background-image: url('images/bluebird.png');
			}

			.enemy.red{
				background-image: url('images/redbird.png');
			}

			.enemy.green{
				background-image: url('images/greenbird.png');
			}

			.enemy.pink{
				background-image: url('images/pinkbird.png');
			}




	</style>
</head>
<body>
	<div class="stage">
		<div class="dragon"></div>
	</div>



<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<!-- jquery plugins go here -->
<script type="text/javascript">
		const dragon = $('.dragon'), //dragon is always the dragon
			  stage = $('.stage');

		var gameRunning = false, //stores if our game is running, this will be important later
		    speed = 6,
		    score = 0;

//this variable is a Object Literal, its format is JSON
//property:value, property:value, property:value,....
//this will store the direction the user indicates they want the dragon to move. 
		let dir = {
					up:false,
					down:false,
					left:false,
					right:false
					}   	  	

	$(document).keydown( function(e){
			//e stands for event, allows us to get the event object properties
			console.log(e.which); //tells us which key got sent down to the keyboard.
			//arrow keys: up:38, down: 40, left: 37, right: 39
			//aswd keys: w: 87, s:83, a:65, d:68

			if(e.which == 38 || e.which == 87){
				//either are true, we know the user wants to go up
				dir.up = true;
			}

			if(e.which == 40 || e.which == 83){
				//either are true, we know the user wants to go down
				dir.down = true;
			}

			if(e.which == 37 || e.which == 65){
				//either are true, we know the user wants to go left
				dir.left = true;
				facingLeft = true;
			}

			if(e.which == 39 || e.which == 68){
				//either are true, we know the user wants to go right
				dir.right = true;
				facingLeft = false;
			}

			//shift button will go faster
			if(e.which == 16){
				speed = 10;
			}

			//spacebar to shoot flame
			if(e.which == 32){
				//console.log('fire, fire, fiiiiiiiirrrrre!');
				shootFlame();
			}


		//	console.log('keydown', dir)

	}) //end keydown


	$(document).keyup( function(e){
			//e stands for event, allows us to get the event object properties
			//console.log(e.which); //tells us which key got released
			//arrow keys: up:38, down: 40, left: 37, right: 39
			//aswd keys: w: 87, s:83, a:65, d:68

			if(e.which == 38 || e.which == 87){
				//either are true, we know the user wants to no longer go up
				dir.up = false;
			}

			if(e.which == 40 || e.which == 83){
				//either are true, we know the user wants to no longer go down
				dir.down = false;
			}

			if(e.which == 37 || e.which == 65){
				//either are true, we know the user wants to no longer go left
				dir.left = false;
			}

			if(e.which == 39 || e.which == 68){
				//either are true, we know the user wants to no longer go right
				dir.right = false;
			}
//			console.log('keyup', dir)
			if(e.which == 16){
				speed = 6;
			}

	}) //end keyup


//gameLoop is the main programming for our game and will run each animation frame

	function gameLoop(){
		let newTop = 0,
			newLeft = 0; //resets these values every time this function is run.

			if(dir.up == true){
				//if(dir.up) same thing -
				newTop -= speed; 
			}

			if(dir.down == true){
				//if(dir.up) same thing -
				newTop += speed; 
			}

			if(dir.left){
				//dir.left is true, therefore the conditional renders as true
				newLeft -= speed;

			}

			if(dir.right){
				//dir.right is true, therefore the conditional renders as true
				newLeft += speed;
			}

//get the current position of the dragon:
			let dTop = dragon.position().top;
			let dLeft = dragon.position().left;

//dragon height and width
			let dHeight = 136;
			let dWidth =  200;  
			// dragon.width(); gets the width value dynamically
			//use static values like dHeight when this value won't change
			//use dynamic values when they might change - ex: mario eats the mushroom			

//our stage is dynamic, we don't know what its height or width is at any given moment, so we need to check
			//stage boundaries:
			let sHeight = stage.height();
			let sWidth = stage.width(); 

			if(dTop + newTop < 0){
				newTop = 0;
				newTop-= dTop;
			}

			if(dLeft+newLeft < 0 ){
				newLeft = 0;
				newLeft -= dLeft;
			}

			if(dLeft+newLeft+dWidth > sWidth){
				newLeft = 0;
				newLeft += (sWidth-dWidth-dLeft );
			}

			if(dTop+dHeight+newTop > sHeight){
				newTop = 0;
				newTop += (sHeight-dHeight-dTop );
			}
			//console.log(newTop, newLeft);
			
			dragon.css({top:'+='+newTop, left:'+='+newLeft});

			//call rectHit to determine if our flame has hit an enemy
			$('.flame').each( function(){
				//many to many comparison
				let flame = $(this); //'this' is the flame the each function is handling at that moment
				$('.enemy').each( function(){
					let enemy = $(this); //the enemy we are comparing the flame against

					//new classes to check against: blue, red, purple, green, pink
					var value = 0;
					if(recthit(flame, enemy)){
						flame.remove();
						enemy.remove();
						if(enemy.hasClass('blue')){
							value = 8;
						}else if(enemy.hasClass('red')){
                            value = 5;
						}else if(enemy.hasClass('green')){
							value = 3;
						}else if(enemy.hasClass('pink')){
							//pink
							value = 2;
						}else{
							//purple
							value = 1;
						}

						score += value;
						dragon.text(score);

					}



				})



			})


			bgMove();
	//console.log('gameLoop');
	//setTimeout(gameLoop, 1000/30); //runs once.
	window.requestAnimationFrame(gameLoop);
	} //end gameLoop()

	//setInterval(gameLoop, 1000/30); //runs every 30FPS
	//setTimeout(gameLoop, 1000/30); //runs once.
	//window.requestAnimationFrame(gameLoop); //calls the next frame to call gameLoop to run
	gameLoop();

	function shootFlame(){
		let flame = $('<div>').addClass('flame'),
		    bgPos = -49,
		    dTop = dragon.position().top,
		    dLeft = dragon.position().left,
		    fTop = dTop+((144/2) + (24/2)),
	    	fLeft = dLeft+200; //puts flame to the right of our 200px wide dragon
		    let endStage = stage.width()+100;
		    //144/2 + 24/2 puts flame in the middle of our 144px high dragon
		    if(facingLeft){
		    fLeft = dLeft-49; //puts flame to the right of our 200px wide dragon
		    endStage = -100; //changes our endStage value
		    bgPos = 0;
		    }

		    flame.css({top:fTop, left: fLeft, 'background-position': bgPos+'px 0px'}).appendTo(stage); 
		    //positioning the flame relative to the dragon / appending the flame to the stage

		    

		    flame.animate({left: endStage}, 1000, function(){
		    	$(this).remove();
		    })

	}//end shootFlame


//bgMove code 
var bgx = 0;
var bgy = 0;
var xSpeed = -3; //number of px to move horizontally
var ySpeed = 0; //number of px to move vertically

//pans background

function bgMove(){
	if(facingLeft){
	xSpeed = Math.abs(xSpeed); //abs turns to positive	
	}else{
	xSpeed = -3;	
	}	
	bgx += xSpeed;
	bgy += ySpeed;
	$('.stage').css({'background-position': bgx+'px '+bgy+'px'});
}



//setInterval to create enemies
let	createEnemyInt = setInterval(createEnemy, 1000);

	function createEnemy(){
		let enemy = $('<div>').addClass('enemy');
		let rando = Math.random();
		//console.log(rando);
		if( rando > .9 ){
			enemy.addClass('blue');
		}else if(rando > .75){
			enemy.addClass('green');
		}else if(rando > .55){
			enemy.addClass('red');
		}else if(rando > .35){
			enemy.addClass('pink');
		}else{
			enemy.addClass('purple');
		}

		//position enemy on stage:
		let eLeft = stage.width() + 100; //starts enemy 100px off of stage
		let eTop = parseInt(Math.random() * (stage.height()-44) )
		//console.log(eTop);
		enemy.css({top:eTop, left:eLeft});
		stage.append(enemy);
		enemy.animate({left: -100}, 2500, 'linear', function(){
			$(this).remove(); //removes enemy when it is done animating
		})

	}//end createEnemy


	//vanilla JS sprite animation of frames:
var curFrame = 0; //keeps track of which frame we are on
var facingLeft = false;

//function to drive Dragon's flying animation
function dragonFlap(){
	var frames = [0,1,2,3];
	var frameWidth = 200;
	var frameHeight = 144;
	var bgPosX = -(frameWidth * frames[curFrame]);
	var bgPosY = 0;
	if(facingLeft){
		//do code if true
		bgPosY = -frameHeight;
	}


	$('.dragon').css({'background-position': bgPosX+'px '+bgPosY+'px'});

	curFrame++;

	if(curFrame == frames.length){
		curFrame = 0;
	}
}

//put interval into a variable so I can use clearInterval on the timer later.
var dragonFlightAni = setInterval(dragonFlap, 1000/10);

function recthit(rectone, recttwo){

    var r1 = $(rectone);
    var r2 = $(recttwo);
    
    var r1x = r1.offset().left;
    var r1w = r1.width();
    var r1y = r1.offset().top;
    var r1h = r1.height();
    
    var r2x = r2.offset().left;
    var r2w = r2.width();
    var r2y = r2.offset().top;
    var r2h = r2.height();
    
    if( r1y+r1h < r2y ||
        r1y > r2y+r2h ||
        r1x > r2x+r2w ||
        r1x+r1w < r2x ){
        return false;
    }else{
        return true;   
    }
    
}//end function 





</script>
</body>
</html>