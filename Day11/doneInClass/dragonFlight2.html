<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Animation Frame Rate Example</title>
	<style type="text/css">
		body{
				font-family: Verdana;
				font-size: 18px;
				margin: 0 auto;
			}

			.dragon{
				position: absolute;
				top: 100px;
				left: 100px;
				width: 50px;
				height: 50px;
				background: limegreen;
			}


			.stage{
				position: absolute;
				top: 30px;
				left: 10px;
				right: 10px;
				bottom: 10px;
				background: #add;
				border: 1px solid black;
				overflow: hidden;
			}

			.flame{
				width: 100px;
				height: 40px;
				background: red;
				position: absolute;
				top: 300px; 
				left: 300px;
			}

			.enemy{
				width: 20px;
				height: 20px;
				position: absolute;
				border: 1px solid black;
			}

			.enemy.blue{
				background:blue; 
			}

			.enemy.red{
				background:red; 
			}
			.enemy.green{
				background:green; 
			}
			.enemy.purple{
				background:purple; 
			}

			.enemy.pink{
				background:pink; 
			}




	</style>
</head>
<body>
	<div class="stage">	
		<div class="dragon"></div>
<!-- 	<div class="flame"></div>
		<div class="enemy blue"></div> -->
	</div>


<!-- best practice put scripts at the bottom -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<!-- any plugins/extensions on jQuery go here-->

<script type="text/javascript">
	'use strict';
	//const variables
	const dragon = $('.dragon'),
		  stage = $('.stage'),
		  dir = { 
			  		up:false,
			  		down:false,
			  		left:false,
			  		right:false
		  		}; //this is an object literal. Represents the direction that the user wants to move the div based off of keyboard indications (arrows for example) since we are not redeclaring dir,but manipulating its properties we can use const

//let variables
	let gameRunning = false,
		speed = 6, //number of px our div will move. This may change!
		createEnemyInt = setInterval(createEnemy, 1000),
		score = 0;

		$(document).keydown( function(e) {
			//e captures the event object information, which tells me which key was sent down

			//arrows: up:38, down:40, left:37, right:39
			//aswd: w:87, s:83, a: 65, d:68

			if(e.which == 38 || e.which == 87 ){
				dir.up = true;
			}

			if(e.which == 40 || e.which == 83 ){
				dir.down = true;
			}

			if(e.which == 37 || e.which == 65){
				dir.left = true;
			}			

			if(e.which == 39 || e.which == 68){
				dir.right = true;
			}			

		//hit shift key to go a little faster
			if(e.which == 16){
				speed = 10; 
			}

			//TODO: shootflame spacebar

			if(e.which == 32){
				//32 is spacebar
				console.log('Woooooosh!');
				shootFlame();
			}

					console.log('keydown', e.which);
//			console.log(dir);
		}) //end keydown

		$(document).keyup( function(e) {
			//e captures the event object information, which tells me which key was released

			//arrows: up:38, down:40, left:37, right:39
			//aswd: w:87, s:83, a: 65, d:68

			if(e.which == 38 || e.which == 87 ){
				dir.up = false;
			}

			if(e.which == 40 || e.which == 83 ){
				dir.down = false;
			}

			if(e.which == 37 || e.which == 65){
				dir.left = false;
			}			

			if(e.which == 39 || e.which == 68){
				dir.right = false;
			}			
			
		//hit shift key to go a little faster
			if(e.which == 16){
				speed = 6; 
			}

			console.log('keyup', dir);
		})

		function gameLoop(){
			let newTop = 0,
			    newLeft = 0;
			 //sets the values of hte top and left to 0, but is used to store the value of our dragon's top and left position
			 
			 if(dir.up == true){
			 	//or dir.up
			 	newTop -= speed;
			 }   

			 if(dir.down){
			 	//or dir.down == true
			 	newTop += speed;
			 }   

			 if(dir.left == true){
			 	newLeft -= speed;
			 }

			 if(dir.right){
			 	console.log('true?')
			 	console.log(dir);
			 	newLeft += speed;
			 }

			//dragon's current position:
		 	let dTop = dragon.position().top;
		 	let dLeft = dragon.position().left;

			//dragon's height and width
			let dHeight = 50;
			let dWidth = 50; //dynamic value dragon.width() 	 	
	
			//check against stage dynamic boundaries
			let sHeight = stage.height(); //gets current value of stage's height
			let sWidth = stage.width();  //gets current value of stage's width

			if(dTop + newTop < 0){
				newTop = 0;
				newTop -= dTop;
			}

			if(dLeft+newLeft <0){
				newLeft = 0;
				newLeft -= dLeft;
			}
			//check against right boundary
			if(dLeft+newLeft+dWidth > sWidth ){
				newLeft = 0;
				newLeft+= (sWidth-dWidth-dLeft);
			}
			//check against bottom boundary
			if(dTop+newTop+dHeight > sHeight ){
				newTop = 0;
				newTop += (sHeight-dHeight-dTop);

			}
			dragon.css({top: '+='+newTop, left: '+='+newLeft})

			//call recthit to determine if our flame has hit an enemy
			$('.flame').each( function(){
				//many to many comparison
				let flame = $(this); //'this is the flame the program is referencing right now'

				$('.enemy').each( function(){
					//compares the location of each enemy to the individual flame referenced above
					let enemy = $(this); //this is the individual enemy that we are comparing the flame against

					if(recthit(flame, enemy)){
						flame.remove();
						enemy.remove();

						let value = 0;

						if(enemy.hasClass('blue')){
							value = 3;
						}else if(enemy.hasClass('red')){
							value = 2;
						}else{
							value = 1;
						}

						score += value;
						dragon.text(score);
					}

				})

			})



		requestAnimationFrame(gameLoop);
		} //end gameLoop()

		gameLoop();

function shootFlame(){
//when user presses spacebar, shoot flame from dragon
	let flame = $('<div>').addClass('flame'),
	    dTop = dragon.position().top,
	    dLeft = dragon.position().left,
	    fTop = dTop+23, //
	    fLeft = dLeft+50; //the width of our dragon is 50

	flame.css({top: fTop, left:fLeft})
	flame.appendTo(stage)

	flame.animate({left: stage.width()+100}, 1000, function(){
		$(this).remove(); //garbage collection this removes the element when we are done with it
	})

}

//the interval for this is defined at the top
function createEnemy(){
	let enemy = $('<div>').addClass('enemy');
	let rando = Math.random(); //Math.random() gives us a random decimal value from 0 to ALMOST 1
	console.log(rando, 'when math random is run again', Math.random());

	if(rando > .666666666){
		enemy.addClass('blue')
	}else if(rando > .33333333){
		enemy.addClass('red')
	}else{
		enemy.addClass('green')
	}

	//position enemy on stage
	let eLeft = stage.width()+100 //starts enemy 100px off stage
	let eTop = parseInt(Math.random() * (stage.height() - 20) )
	console.log(eTop, eLeft)
	enemy.css({top:eTop, left:eLeft})
	stage.append(enemy);
	//default values in jQ are in px. To add a % for example: width:30+'%'
	//check the lifebar when we do that.
	enemy.animate({left:-100}, 2500, 'linear', function(){
		$(this).remove();
	})

}


function recthit(rectone, recttwo){
    console.log('recthit called');
    var r1 = $(rectone);
    var r2 = $(recttwo);
    
    var r1x = r1.offset().left;
    var r1w = r1.width();
    var r1y = r1.offset().top;
    var r1h = r1.height();
    
    var r2x = r2.offset().left;
    var r2w = r2.width();
    var r2y = r2.offset().top;
    var r2h = r2.height();
    
    if( r1y+r1h < r2y ||
        r1y > r2y+r2h ||
        r1x > r2x+r2w ||
        r1x+r1w < r2x ){
        //console.log('recthit-false')
        return false;
    }else{
      //console.log('recthit-true')
        return true;   
    }
    
}//end function 


</script>
</body>
</html>